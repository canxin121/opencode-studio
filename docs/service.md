# Service installation

English | [简体中文](service.zh-CN.md)

This document describes installing the Rust server (`opencode-studio`) as a background service.

Service install has two runtime variants:

- API-only (default): backend-only (`/api/*` etc.)
- With frontend: backend + static UI (`--ui-dir` in generated config)

The server manages an OpenCode connection through local `opencode serve`, so `opencode`
must be installed and available on `PATH`.

## Prerequisites

- OpenCode CLI must already be installed on every platform (`opencode` available on `PATH`).
- Windows service install requires:
  - elevated PowerShell (Run as Administrator)
  - `sc.exe` (built into standard Windows installations)

Install OpenCode (choose one):

```bash
curl -fsSL https://opencode.ai/install | bash
# or
brew install anomalyco/tap/opencode
```

```powershell
scoop install opencode
# or
choco install opencode
# or
npm i -g opencode-ai@latest
```

Verify:

```bash
opencode --version
```

## Linux / macOS (curl | bash)

Install with bundled frontend:

```bash
curl -fsSL https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/install-service.sh | bash -s -- --with-frontend
```

Install API-only:

```bash
curl -fsSL https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/install-service.sh | bash
```

Pin a release version (recommended for production-like installs):

```bash
curl -fsSL https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/install-service.sh | bash -s -- --version v0.1.0 --with-frontend
```

After installation:

- Linux systemd user service: `systemctl --user status opencode-studio`
- Linux system service: `sudo systemctl status opencode-studio`
- macOS launchd agent: `launchctl list | grep opencode`

Uninstall service unit (keeps binary/data unless you delete them):

```bash
curl -fsSL https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/uninstall-service.sh | bash
```

## Windows (PowerShell)

The installer creates a Windows service via `sc.exe`.

Run in an elevated PowerShell:

Install with bundled frontend:

```powershell
iex "& { $(irm https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/install-service.ps1) } -WithFrontend"
```

Install API-only:

```powershell
iex "& { $(irm https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/install-service.ps1) }"
```

Uninstall:

```powershell
iex "& { $(irm https://raw.githubusercontent.com/canxin121/opencode-studio/main/scripts/uninstall-service.ps1) }"
```

## Access in Browser

- Default service URL: `http://127.0.0.1:3000`.
- If installed with frontend, open `http://127.0.0.1:3000` directly.
- If installed API-only, use `http://127.0.0.1:3000/health` to verify service health.
- To enable UI after API-only install, set `ui_dir` in `opencode-studio.toml` to a valid `dist` path, or reinstall with frontend.
- For remote access from another machine, set `host = "0.0.0.0"`, restart service, then open `http://<server-ip>:3000`.

## Config

Service install uses a centralized root directory by default:

- Unix/macOS: `~/opencode-studio`
- Windows: `%USERPROFILE%\\opencode-studio`

Default layout under that directory:

- `bin/opencode-studio` (or `bin/opencode-studio.exe` on Windows)
- `dist/` (only when installing with frontend)
- `opencode-studio.toml`

Adjust `[backend]` fields in `opencode-studio.toml` to change runtime behavior:

- `host` / `port`
- `opencode_host` / `opencode_port` (connect to existing OpenCode)
- `ui_dir` (serve frontend dist)

Service units generated by the installer explicitly start with
`--config <install-root>/opencode-studio.toml`.
You can still override runtime config with `--config <path>` or `OPENCODE_STUDIO_CONFIG`.
